================================================================================
DEPLOYMENT CHECKLIST - Files & Instructions
================================================================================

ğŸ“¦ FILES TO DEPLOY
================================================================================

NEW FILES (Deploy as-is):
âœ“ admin/profile.php
âœ“ admin/privacy_policy.php  
âœ“ admin/manage_privacy_policies.php
âœ“ database/migration_privacy_policy.sql
âœ“ database/migration_initial_privacy_policy.sql
âœ“ docs/PRIVACY_POLICY_SYSTEM.md
âœ“ includes/PrivacyPolicyTemplate.php

MODIFIED FILES (Replace existing):
âœ“ admin/login.php
âœ“ verify_magiclink.php
âœ“ admin/dashboard.php
âœ“ includes/functions.php

DOCUMENTATION (For reference):
âœ“ PRIVACY_POLICY_SETUP.txt
âœ“ IMPLEMENTATION_SUMMARY.txt
âœ“ IMPLEMENTATION_COMPLETE.txt

================================================================================
ğŸ—‚ï¸ DIRECTORY STRUCTURE AFTER DEPLOYMENT
================================================================================

OwMM/
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ profile.php ........................ NEW
â”‚   â”œâ”€â”€ privacy_policy.php ................ NEW
â”‚   â”œâ”€â”€ manage_privacy_policies.php ........ NEW
â”‚   â”œâ”€â”€ login.php ......................... MODIFIED
â”‚   â”œâ”€â”€ dashboard.php ..................... MODIFIED
â”‚   â””â”€â”€ [other existing files]
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migration_privacy_policy.sql ....... NEW
â”‚   â”œâ”€â”€ migration_initial_privacy_policy.sql NEW
â”‚   â””â”€â”€ [other existing migrations]
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ PRIVACY_POLICY_SYSTEM.md .......... NEW
â”‚   â””â”€â”€ [other existing docs]
â”œâ”€â”€ includes/
â”‚   â”œâ”€â”€ functions.php ..................... MODIFIED
â”‚   â”œâ”€â”€ PrivacyPolicyTemplate.php ......... NEW
â”‚   â””â”€â”€ [other existing files]
â”œâ”€â”€ verify_magiclink.php .................. MODIFIED
â”œâ”€â”€ PRIVACY_POLICY_SETUP.txt ............. NEW (reference)
â”œâ”€â”€ IMPLEMENTATION_SUMMARY.txt ........... NEW (reference)
â”œâ”€â”€ IMPLEMENTATION_COMPLETE.txt .......... NEW (reference)
â””â”€â”€ [other existing files]

================================================================================
âš™ï¸ DEPLOYMENT STEPS
================================================================================

STEP 1: BACKUP
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Before any changes, backup:
  â€¢ Database (full dump)
  â€¢ Current code (zip or git)
  â€¢ Any current privacy policy documents

Commands:
  $ mysqldump -u username -p database_name > backup_$(date +%Y%m%d).sql
  $ git commit -m "Backup before privacy policy implementation"

STEP 2: DATABASE MIGRATIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
CRITICAL: Run in order!

1. Run migration_privacy_policy.sql
   $ mysql -u username -p database_name < database/migration_privacy_policy.sql

2. Run migration_initial_privacy_policy.sql
   $ mysql -u username -p database_name < database/migration_initial_privacy_policy.sql

Verify:
  $ mysql -u username -p database_name -e "SHOW TABLES LIKE 'privacy%';"
  $ mysql -u username -p database_name -e "SELECT COUNT(*) FROM privacy_policy_versions;"

STEP 3: COPY NEW FILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Copy to production server:

admin/
  âœ“ profile.php
  âœ“ privacy_policy.php
  âœ“ manage_privacy_policies.php

includes/
  âœ“ PrivacyPolicyTemplate.php

docs/
  âœ“ PRIVACY_POLICY_SYSTEM.md

database/
  âœ“ migration_privacy_policy.sql (already run)
  âœ“ migration_initial_privacy_policy.sql (already run)

STEP 4: REPLACE MODIFIED FILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Replace these files (have your original backups!):

  âœ“ admin/login.php
  âœ“ admin/dashboard.php
  âœ“ verify_magiclink.php
  âœ“ includes/functions.php

Or use git:
  $ git pull origin main (if using version control)

STEP 5: SET FILE PERMISSIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Make sure files are readable by web server:

$ chmod 644 admin/profile.php
$ chmod 644 admin/privacy_policy.php
$ chmod 644 admin/manage_privacy_policies.php
$ chmod 644 includes/PrivacyPolicyTemplate.php

STEP 6: VERIFY DEPLOYMENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Check:
  âœ“ admin/profile.php loads (403 if not logged in)
  âœ“ admin/privacy_policy.php loads (403 if not logged in)
  âœ“ admin/manage_privacy_policies.php loads (403 if not admin)

Test URLs:
  https://yourdomain.com/admin/profile.php
  https://yourdomain.com/admin/privacy_policy.php
  https://yourdomain.com/admin/manage_privacy_policies.php

STEP 7: CUSTOMIZE PRIVACY POLICY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Login as admin
2. Navigate to: https://yourdomain.com/admin/manage_privacy_policies.php
3. Click "Edit" on Version 1.0
4. Update:
   - Organization name and address
   - Contact email and phone
   - Data Protection Officer (if applicable)
   - Specific processing activities
   - Data retention periods
5. Save changes

STEP 8: TEST THE SYSTEM
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Test Cases:

Test 1: Login with privacy policy
  1. Try to log in (admin/login.php)
  2. You should see privacy policy
  3. Accept it
  4. Should see dashboard
  âœ“ Privacy policy required

Test 2: User rejection
  1. Create test account
  2. Try to log in
  3. Reject privacy policy
  4. Account should be deactivated
  âœ“ User cannot log back in

Test 3: Supporter redirect
  1. Login as supporter user
  2. Should go to profile.php (not dashboard)
  3. Should see personal data
  4. Should see obligations
  âœ“ Supporter restricted

Test 4: Admin access
  1. Login as admin
  2. Go to /admin/manage_privacy_policies.php
  3. Should see policy management
  âœ“ Admin can manage policies

Test 5: Profile editing
  1. Go to /admin/profile.php
  2. Update personal information
  3. Save
  4. Refresh page
  5. Changes should persist
  âœ“ Profile edits work

================================================================================
ğŸ“‹ TESTING CHECKLIST (BEFORE GOING LIVE)
================================================================================

LOGIN SYSTEM
  â˜ Regular password login shows privacy policy
  â˜ Magic link login shows privacy policy
  â˜ Both methods enforce acceptance
  â˜ Rejected users cannot log in

PRIVACY POLICY
  â˜ Can view policy (admin/privacy_policy.php)
  â˜ Can accept policy
  â˜ Can reject policy
  â˜ Can print policy
  â˜ New version appears on login

PROFILES
  â˜ Can access profile (admin/profile.php)
  â˜ Can edit personal information
  â˜ Can update address
  â˜ Can update IBAN
  â˜ Can manage email preferences
  â˜ Changes persist after logout/login

SUPPORTER RESTRICTIONS
  â˜ Supporter redirects to profile (not dashboard)
  â˜ Supporter can see their data
  â˜ Supporter can see their obligations
  â˜ Admin can still access dashboard

ADMIN FEATURES
  â˜ Can access policy management page
  â˜ Can create new policy versions
  â˜ Can publish policies
  â˜ Can view statistics
  â˜ Can see users pending acceptance

DATABASE
  â˜ privacy_policy_versions table exists
  â˜ privacy_policy_consent table exists
  â˜ email_consent table exists
  â˜ users table has new columns
  â˜ Migration scripts ran without errors

AUDIT TRAIL
  â˜ Acceptances logged in database
  â˜ IP addresses recorded
  â˜ Timestamps accurate
  â˜ User agent captured
  â˜ Cannot delete consent records

================================================================================
ğŸ”„ ROLLBACK PROCEDURE (If needed)
================================================================================

If something goes wrong:

1. STOP - Do not continue
2. Restore database from backup:
   $ mysql -u username -p database_name < backup_YYYYMMDD.sql
3. Restore code files from backup:
   - Restore original versions of modified files
   - Remove new files (profile.php, privacy_policy.php, etc.)
4. Verify system working:
   - Test login
   - Test existing features
   - Check database
5. Debug & Re-deploy:
   - Identify issue
   - Fix problem
   - Test in staging first
   - Deploy again

================================================================================
ğŸ“Š POST-DEPLOYMENT MONITORING
================================================================================

First Week:
  â€¢ Check error logs daily
  â€¢ Monitor user logins
  â€¢ Verify audit trail entries
  â€¢ Check email alerts

First Month:
  â€¢ Monitor acceptance rates
  â€¢ Check for user complaints
  â€¢ Verify database performance
  â€¢ Review audit logs

Ongoing:
  â€¢ Check audit logs weekly
  â€¢ Update privacy policy as needed
  â€¢ Train new staff
  â€¢ Review statistics
  â€¢ Keep backups current

Commands to Monitor:
  # Check latest consent records
  SELECT * FROM privacy_policy_consent ORDER BY consent_date DESC LIMIT 10;

  # Check rejection count
  SELECT COUNT(*) FROM privacy_policy_consent WHERE accepted = 0;

  # Check deactivated users
  SELECT email FROM users WHERE active = 0 AND privacy_policy_accepted_at IS NOT NULL;

================================================================================
ğŸ”” NOTIFICATION
================================================================================

Notify users about:
  1. New privacy policy system
  2. Profile page availability
  3. Email preference settings
  4. Consent requirements
  5. How to access their data

Template email:

Subject: Neue DatenschutzerklÃ¤rung und Profilverwaltung

Liebe Mitglieder,

wir haben ein neues Datenschutz- und Datenverwaltungssystem implementiert, 
um Ihre Datenschutzrechte zu stÃ¤rken. Beim nÃ¤chsten Login werden Sie gebeten, 
unserer DatenschutzerklÃ¤rung zuzustimmen.

Sie kÃ¶nnen jederzeit Ihr Profil anpassen:
- PersÃ¶nliche Daten ansehen und aktualisieren
- E-Mail-Einstellungen verwalten
- Ihre Forderungen einsehen
- Ihr Konto verwalten

Mein Profil: https://yourdomain.com/admin/profile.php

Mit freundlichen GrÃ¼ÃŸen,
[Ihre Organisation]

================================================================================
âœ… GO-LIVE CHECKLIST
================================================================================

Before announcing to users:
  â˜ All migrations executed successfully
  â˜ New files deployed and accessible
  â˜ Modified files updated
  â˜ Privacy policy customized
  â˜ All test cases passed
  â˜ No error logs
  â˜ Database verified
  â˜ Backup created
  â˜ Documentation reviewed
  â˜ Admin staff trained

Ready to go live:
  â˜ Notify users
  â˜ Monitor first 48 hours closely
  â˜ Have support ready
  â˜ Be prepared for rollback

================================================================================

Questions during deployment?
â†’ See: docs/PRIVACY_POLICY_SYSTEM.md
â†’ See: PRIVACY_POLICY_SETUP.txt
â†’ Check database for error logs
â†’ Review error logs in web server

Status: READY FOR DEPLOYMENT
Last Updated: January 24, 2026
================================================================================
